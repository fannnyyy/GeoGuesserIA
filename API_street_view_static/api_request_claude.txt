Parfait ! Je vais vous cr√©er un script Python complet avec un syst√®me de suivi et de limite de budget.Parfait ! Je vous ai cr√©√© un script complet avec toutes les protections n√©cessaires. Voici ce qu'il fait :

## üõ°Ô∏è Protections du budget

‚úÖ **Suivi en temps r√©el** - Calcule et affiche le budget restant apr√®s chaque image
‚úÖ **Blocage automatique** - S'arr√™te avant de d√©passer votre limite
‚úÖ **Historique persistant** - Sauvegarde dans `budget_tracker.json` (m√™me si vous red√©marrez)
‚úÖ **V√©rification avant t√©l√©chargement** - V√©rifie que Street View existe √† ces coordonn√©es (√©vite les co√ªts inutiles)

## üìÅ Structure cr√©√©e

```
dataset/
‚îú‚îÄ‚îÄ images/              # Toutes vos images t√©l√©charg√©es
‚îú‚îÄ‚îÄ metadata/            # M√©tadonn√©es suppl√©mentaires
‚îú‚îÄ‚îÄ coordinates.csv      # Fichier CSV avec image_id, lat, lon, pays, etc.
‚îî‚îÄ‚îÄ budget_tracker.json  # Suivi du budget et historique
```

## üöÄ Pour commencer

1. **Installez les d√©pendances** :
```bash
pip install requests
```

2. **Obtenez votre cl√© API** :
   - Allez sur [Google Cloud Console](https://console.cloud.google.com)
   - Activez "Street View Static API"
   - Cr√©ez une cl√© API
   - Remplacez `VOTRE_CLE_API_ICI` dans le script

3. **Lancez le script** :
```bash
python script.py
```

## üí° Fonctionnalit√©s utiles

- **R√©gions disponibles** : `world`, `europe`, `usa`, `asia`, `oceania`, `africa`
- **Param√®tres personnalisables** : taille, angle, champ de vision
- **D√©lai entre requ√™tes** : √âvite de surcharger l'API
- **Retry intelligent** : Si une coordonn√©e n'a pas de Street View, essaie ailleurs

Voulez-vous que j'ajoute des fonctionnalit√©s suppl√©mentaires (par exemple : cibler des villes sp√©cifiques, t√©l√©charger plusieurs angles du m√™me endroit, ou filtrer par pays) ?




import requests
import json
import os
import csv
import time
from datetime import datetime
import random

class StreetViewDatasetCollector:
    def __init__(self, api_key, max_budget=300.0, cost_per_image=0.007):
        """
        Initialise le collecteur de dataset Street View
        
        Args:
            api_key: Votre cl√© API Google Cloud
            max_budget: Budget maximum en dollars (d√©faut: 300$)
            cost_per_image: Co√ªt par image en dollars (d√©faut: 0.007$)
        """
        self.api_key = api_key
        self.max_budget = max_budget
        self.cost_per_image = cost_per_image
        self.base_url = "https://maps.googleapis.com/maps/api/streetview"
        
        # Cr√©er les dossiers n√©cessaires
        self.images_dir = "dataset/images"
        self.metadata_dir = "dataset/metadata"
        os.makedirs(self.images_dir, exist_ok=True)
        os.makedirs(self.metadata_dir, exist_ok=True)
        
        # Fichier pour suivre le budget
        self.budget_file = "dataset/budget_tracker.json"
        self.load_budget_tracker()
        
        # Fichier CSV pour les coordonn√©es
        self.csv_file = "dataset/coordinates.csv"
        self.init_csv()
    
    def load_budget_tracker(self):
        """Charge l'historique de consommation du budget"""
        if os.path.exists(self.budget_file):
            with open(self.budget_file, 'r') as f:
                self.tracker = json.load(f)
        else:
            self.tracker = {
                "total_spent": 0.0,
                "images_downloaded": 0,
                "last_updated": datetime.now().isoformat(),
                "history": []
            }
            self.save_budget_tracker()
    
    def save_budget_tracker(self):
        """Sauvegarde l'√©tat du budget"""
        self.tracker["last_updated"] = datetime.now().isoformat()
        with open(self.budget_file, 'w') as f:
            json.dump(self.tracker, f, indent=2)
    
    def init_csv(self):
        """Initialise le fichier CSV pour les coordonn√©es"""
        if not os.path.exists(self.csv_file):
            with open(self.csv_file, 'w', newline='', encoding='utf-8') as f:
                writer = csv.writer(f)
                writer.writerow(['image_id', 'filename', 'latitude', 'longitude', 
                               'country', 'timestamp', 'heading', 'pitch', 'fov'])
    
    def check_budget(self, num_images=1):
        """V√©rifie si le budget permet de t√©l√©charger num_images"""
        projected_cost = self.tracker["total_spent"] + (num_images * self.cost_per_image)
        remaining = self.max_budget - self.tracker["total_spent"]
        
        if projected_cost > self.max_budget:
            return False, remaining
        return True, remaining
    
    def get_status(self):
        """Affiche le statut actuel du budget"""
        remaining = self.max_budget - self.tracker["total_spent"]
        images_remaining = int(remaining / self.cost_per_image)
        
        print(f"\n{'='*60}")
        print(f"STATUT DU BUDGET")
        print(f"{'='*60}")
        print(f"Budget maximum:        {self.max_budget:.2f} $")
        print(f"D√©pens√©:              {self.tracker['total_spent']:.2f} $")
        print(f"Restant:              {remaining:.2f} $")
        print(f"Images t√©l√©charg√©es:  {self.tracker['images_downloaded']}")
        print(f"Images restantes:     {images_remaining}")
        print(f"Pourcentage utilis√©:  {(self.tracker['total_spent']/self.max_budget)*100:.1f}%")
        print(f"{'='*60}\n")
    
    def get_random_coordinates(self, region="world"):
        """
        G√©n√®re des coordonn√©es GPS al√©atoires
        
        Args:
            region: "world", "europe", "usa", "asia", etc.
        """
        regions = {
            "world": {"lat": (-60, 70), "lon": (-180, 180)},
            "europe": {"lat": (35, 71), "lon": (-10, 40)},
            "usa": {"lat": (25, 49), "lon": (-125, -66)},
            "asia": {"lat": (-10, 55), "lon": (60, 150)},
            "oceania": {"lat": (-50, -10), "lon": (110, 180)},
            "africa": {"lat": (-35, 37), "lon": (-20, 52)}
        }
        
        bounds = regions.get(region, regions["world"])
        lat = random.uniform(*bounds["lat"])
        lon = random.uniform(*bounds["lon"])
        
        return round(lat, 6), round(lon, 6)
    
    def check_streetview_availability(self, lat, lon):
        """V√©rifie si Street View est disponible √† ces coordonn√©es"""
        metadata_url = f"{self.base_url}/metadata"
        params = {
            "location": f"{lat},{lon}",
            "key": self.api_key,
            "source": "outdoor"
        }
        
        try:
            response = requests.get(metadata_url, params=params, timeout=10)
            data = response.json()
            
            if data.get("status") == "OK":
                return True, data
            return False, None
        except Exception as e:
            print(f"Erreur lors de la v√©rification: {e}")
            return False, None
    
    def download_image(self, lat, lon, image_id, size="640x640", heading=None, 
                      pitch=0, fov=90):
        """
        T√©l√©charge une image Street View
        
        Args:
            lat, lon: Coordonn√©es GPS
            image_id: Identifiant unique de l'image
            size: Taille de l'image (max: 640x640)
            heading: Direction de la cam√©ra (0-360, None = al√©atoire)
            pitch: Angle vertical (-90 √† 90)
            fov: Champ de vision (10-120)
        """
        # V√©rifier le budget
        can_download, remaining = self.check_budget(1)
        if not can_download:
            print(f"‚ö†Ô∏è  BUDGET √âPUIS√â ! Restant: {remaining:.2f}$")
            return False
        
        # V√©rifier la disponibilit√©
        available, metadata = self.check_streetview_availability(lat, lon)
        if not available:
            print(f"‚ö†Ô∏è  Pas de Street View disponible √† ({lat}, {lon})")
            return False
        
        # Heading al√©atoire si non sp√©cifi√©
        if heading is None:
            heading = random.randint(0, 359)
        
        # T√©l√©charger l'image
        params = {
            "location": f"{lat},{lon}",
            "size": size,
            "heading": heading,
            "pitch": pitch,
            "fov": fov,
            "key": self.api_key,
            "source": "outdoor"
        }
        
        try:
            response = requests.get(self.base_url, params=params, timeout=30)
            
            if response.status_code == 200:
                # Sauvegarder l'image
                filename = f"streetview_{image_id}.jpg"
                filepath = os.path.join(self.images_dir, filename)
                
                with open(filepath, 'wb') as f:
                    f.write(response.content)
                
                # Mettre √† jour le budget
                self.tracker["total_spent"] += self.cost_per_image
                self.tracker["images_downloaded"] += 1
                self.tracker["history"].append({
                    "image_id": image_id,
                    "timestamp": datetime.now().isoformat(),
                    "cost": self.cost_per_image,
                    "lat": lat,
                    "lon": lon
                })
                self.save_budget_tracker()
                
                # Sauvegarder les m√©tadonn√©es dans le CSV
                with open(self.csv_file, 'a', newline='', encoding='utf-8') as f:
                    writer = csv.writer(f)
                    writer.writerow([
                        image_id, filename, lat, lon,
                        metadata.get("location", {}).get("country", "Unknown"),
                        datetime.now().isoformat(),
                        heading, pitch, fov
                    ])
                
                print(f"‚úÖ Image {image_id} t√©l√©charg√©e | Budget restant: {self.max_budget - self.tracker['total_spent']:.2f}$")
                return True
            else:
                print(f"‚ùå Erreur HTTP {response.status_code}")
                return False
                
        except Exception as e:
            print(f"‚ùå Erreur lors du t√©l√©chargement: {e}")
            return False
    
    def collect_dataset(self, num_images, region="world", delay=1.0):
        """
        Collecte un dataset d'images
        
        Args:
            num_images: Nombre d'images √† t√©l√©charger
            region: R√©gion g√©ographique
            delay: D√©lai entre chaque requ√™te (secondes)
        """
        print(f"\nüöÄ D√©but de la collecte de {num_images} images depuis {region}")
        self.get_status()
        
        # V√©rifier si le budget est suffisant
        can_download, remaining = self.check_budget(num_images)
        if not can_download:
            max_possible = int(remaining / self.cost_per_image)
            print(f"‚ö†Ô∏è  Budget insuffisant pour {num_images} images.")
            print(f"Maximum possible: {max_possible} images")
            
            if max_possible > 0:
                response = input(f"T√©l√©charger {max_possible} images ? (o/n): ")
                if response.lower() != 'o':
                    return
                num_images = max_possible
            else:
                print("‚ùå Budget √©puis√© !")
                return
        
        successful = 0
        attempts = 0
        max_attempts = num_images * 3  # Maximum 3 essais par image souhait√©e
        
        while successful < num_images and attempts < max_attempts:
            attempts += 1
            
            # G√©n√©rer des coordonn√©es al√©atoires
            lat, lon = self.get_random_coordinates(region)
            
            # T√©l√©charger l'image
            image_id = f"{self.tracker['images_downloaded'] + 1:06d}"
            
            if self.download_image(lat, lon, image_id):
                successful += 1
                time.sleep(delay)  # Respecter les limites de taux
            else:
                time.sleep(0.5)  # D√©lai plus court en cas d'√©chec
        
        print(f"\n‚úÖ Collecte termin√©e : {successful}/{num_images} images t√©l√©charg√©es")
        self.get_status()


# ===== EXEMPLE D'UTILISATION =====
if __name__ == "__main__":
    # CONFIGURATION
    API_KEY = "VOTRE_CLE_API_ICI"  # ‚ö†Ô∏è Remplacez par votre vraie cl√© API
    MAX_BUDGET = 300.0  # Budget maximum en dollars
    
    # Cr√©er le collecteur
    collector = StreetViewDatasetCollector(
        api_key=API_KEY,
        max_budget=MAX_BUDGET,
        cost_per_image=0.007
    )
    
    # Afficher le statut
    collector.get_status()
    
    # Collecter des images
    # Exemples:
    collector.collect_dataset(num_images=10, region="world", delay=1.0)
    # collector.collect_dataset(num_images=50, region="europe", delay=1.0)
    # collector.collect_dataset(num_images=100, region="usa", delay=1.0)
    
    # Afficher le statut final
    collector.get_status()